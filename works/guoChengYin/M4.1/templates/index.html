<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Title</title>
  	<script src="../static/echarts.js"></script>
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
  <script>
  function valueToColor(value) {
    switch (true) {
      case (value < 1200):
        color = "gray";     // 灰色
        break;
      case (value < 1400):
        color = "green";    // 绿色
        break;
      case (value < 1600):
        color = "cyan";     // 青色
        break;
      case (value < 1900):
        color = "blue";     // 蓝色
        break;
      case (value < 2100):
        color = "purple";   // 紫色
        break;
      case (value < 2300):
        color = "orange";   // 橙色
        break;
      case (value < 3000)://红色
        color = "red";
        break;
      default:
        color = "#070102"//新增黑色
        break;
    }
    return color
    // 红色
  }


  function requestInfo() {
    let handle = document.getElementsByName('handle')[0].value
    var xhr = new XMLHttpRequest()
    xhr.open('GET', "requestUserInfo?handle=" + handle, false);
    try {
      xhr.send()
    } catch (e) {
      console.log(e)
    }
    console.log(xhr.readyState)
    if (xhr.status == "200" || xhr.status == "304") {
      responseData = JSON.parse(xhr.response)
      console.log(responseData)
      document.getElementById("handle").textContent = responseData["handle"]
      document.getElementById("rating").textContent = responseData["rating"]
      document.getElementById("handle").style.color = valueToColor(responseData["rating"])
      const tableThead = document.querySelector("#table1 thead");
      if (responseData["rating"] != "暂无") {
        tableThead.style.display = ""
      } else {
        tableThead.style.display = "none"
      }
      renderTable(responseData)
      //客户端未连接网络等情况
    } else if (xhr.status == 0) {
      alert("建立网络连接失败")
    } else {
      alert(xhr.responseText)
    }
  }
const UpdatedAts=[]
  const ratings=[]
  let ratingMax=0
  const ratingMin=100000
  function renderTable(data) {
    const tableBody = document.querySelector("#table1 tbody");
    tableBody.innerHTML = "";
    rating_hisyory = data["rating_history"]
    rating_hisyory.forEach(function (v) {
        const row = document.createElement("tr");
        const dateCell = document.createElement("td")
        const contestNameCell = document.createElement("td");
        const ratingCell = document.createElement("td");
        const rankCell = document.createElement("td")
        dateCell.textContent = v["ratingUpdatedAt"]

        contestNameCell.textContent = v["contestName"].toString().trim()
        ratingCell.textContent = v["oldRating"] + "—>" + v["newRating"]
        rankCell.textContent = v["rank"]
        row.appendChild(dateCell)
        row.appendChild(contestNameCell)
        row.appendChild(rankCell)
        row.appendChild(ratingCell)
        tableBody.appendChild(row)
      UpdatedAts.push(v["ratingUpdatedAt"].substring(0,10))
      ratings.push(v["newRating"])
      }
    )
myChart.setOption(option);
    UpdatedAts.length=0
    ratings.length=0
  }
</script>


  <style>
    #middle {

      height: 370px;
      margin: 0 auto;
      overflow-y: scroll;

    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    td {
      border: 1px solid #ccc;
      padding: 3px;
      text-overflow: ellipsis;
      overflow: hidden;
      white-space: nowrap;
    }

  </style>
</head>

<body>

<div id="top" style="text-align: center">
  <h3>查询选手</h3>

  <input name="handle" type="text">
  <input type="button" value="提交" onclick="requestInfo()">

</div>
<h3 style="text-align: center;margin-top: 60px">查询结果</h3>

<h4 style="text-align: center;font-size: 5px;font-weight: 1"></h4>
<div style="text-align: center">
  <h1 id="handle"></h1>
  <br>
  <p3>rating:</p3>
  <h1 id="rating"></h1>
</div>
<h5 style="text-align: center">raing history</h5>
<div id="middle">
  <table style="width: 350px;margin:0 auto" id="table1">
    <thead style="display: none">
    <tr style="font-size: 1px;">
      <th id="time">时间</th>
      <th id="contest">比赛</th>
      <th id="rank">rank</th>
      <th id="increment">Δ</th>
    </tr>
    </thead>
    <tbody>

    </tbody>
  </table>
</div>

 <div id="lineChart" style="width: 600px;height:400px;"></div>
  <script type="text/javascript">
   let myChart = echarts.init(document.getElementById('lineChart'));
   yData=[1200,1400,1600,1900,2100,2300,2400,2600,3000]
      // 指定图表的配置项和数据
   console.log(UpdatedAts)
option = {
  tooltip: {
    trigger: 'item',
    formatter: function(params) {
            var dataIndex = params.dataIndex;
            var item = rating_hisyory[dataIndex];
            return   item.contestName + '<br>' +'rank:' + item.rank;
        }
  },
  legend: {},
  toolbox: {
    show: true,
    feature: {
      dataZoom: {
        yAxisIndex: 'none'
      },
      dataView: { readOnly: false },
      magicType: { type: ['line', 'bar'] },
      restore: {},
      saveAsImage: {}
    }
  },
  xAxis: {
    type: 'category',
    boundaryGap: true,
    data:UpdatedAts,
  },
  yAxis: {
       axisLabel: {
                formatter: function (value, index) {
                  if(yData.indexOf(value)!=-1){
                    return value// 使用自定义刻度文本
                  }else {
                    return ""
                  }
                }
            },
    axisLine:{
         show: true,
      lineStyle: {
                color: '#aaa', // 坐标轴线颜色
                width: 1 // 坐标轴线宽度
            }
    },
    min:Math.min(ratings),
    max:Math.max(ratings),
    splitNumber: 9,
    interval: 100
  },
  series: [

    {
      name: 'Rating',
      type: 'line',
      data: ratings,
       lineStyle: {
                color: 'rgb(238,186,63)', // 折线颜色
                width: 2 // 折线宽度
            },
      itemStyle: {
                color: 'rgb(238,186,63)', // 数据点颜色
        symbolSize: 20
            },
      markArea:{
        data:[
                  [{
                    yAxis:0,
                    itemStyle:{
                        color:'rgba(128,128,128)'
                      }
                    },{
                     yAxis:1200
                    }],
                    [{
                    yAxis:1201,
                    itemStyle:{
                        color:'rgb(119,255,119)'
                      }
                    },{
                     yAxis:1400
                    }],
                    [{
                    yAxis:1401,
                    itemStyle:{
                        color:'rgb(119,221,187)'
                      }
                    },{
                     yAxis:1600
                    }],
                  [{
                    yAxis:1601,
                    itemStyle:{
                        color:'rgb(170,170,255)'
                      }
                    },{
                     yAxis:1900
                    }],
                   [{
                    yAxis:1901,
                    itemStyle:{
                        color:'rgb(255,136,255)'
                      }
                    },{
                     yAxis:2100
                    }],
                  [{
                    yAxis:2101,
                    itemStyle:{
                        color:'rgb(255,204,136)'
                      }
                    },{
                     yAxis:2300
                    }],
                  [{
                    yAxis:2301,
                    itemStyle:{
                        color:'rgb(255,187,85)'
                      }
                    },{
                     yAxis:2400
                    }],
                  [{
                    yAxis:2401,
                    itemStyle:{
                        color:'rgb(255,119,119)'
                      }
                    },{
                     yAxis:2600
                    }],
            [{
                    yAxis:2601,
                    itemStyle:{
                        color:'rgb(255,51,51)'
                      }
                    },{
                     yAxis:3000
                    }],
          [{
                    yAxis:3001,
                    itemStyle:{
                        color:'rgb(170,0,0)'
                      }
                    },{
                     yAxis:5000
                    }]
                 ]
      },
      markLine: {
        data: [
          [
            {
              symbol: 'none',
              x: '90%',
              yAxis: 'max'
            },
            {
              symbol: 'circle',
              label: {
                position: 'start',
                formatter: 'Max'
              },
              type: 'max',
              name: '最高点'
            }
          ]
        ]
      }
    }
  ]
};
      // 使用刚指定的配置项和数据显示图表。
      myChart.setOption(option);
</script>
</body>
</html>
